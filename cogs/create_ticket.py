#   1. –°–¥–µ–ª–∞—Ç—å –¥–± —Å –Ω–æ–º–µ—Ä–∞–º–∏ –∏ ID —Ç–∏–∫–µ—Ç–æ–≤ –∏ –∏—Ö –∞–≤—Ç–æ—Ä–∞–º–∏, —á—Ç–æ–±—ã —Å—á–∏—Ç–∞—Ç—å —Ç–∏–∫–µ—Ç—ã –≤ –∏–º–µ–Ω–∏ –∫–∞–Ω–∞–ª–∞ –∏ —á—Ç–æ–±—ã –æ–¥–∏–Ω —é–∑–µ—Ä
#       –Ω–µ –º–æ–≥ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–µ 1 —Ç–∏–∫–µ—Ç–∞.
#   2. –í —Å–æ–∑–¥–∞–Ω–Ω–æ–º –ø–æ –∫–Ω–æ–ø–∫–µ –∫–∞–Ω–∞–ª–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –Ω—É–∂–Ω—ã–µ –ø–µ—Ä–º–∏—à–Ω—ã, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—è–º–∏ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
#       (UI components). 1 –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–¥ –Ω–∏–∫–Ω–µ–π–º (–æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –¥–±, –Ω–∞–≤–µ—Ä–Ω–æ–µ). –í—Ç–æ—Ä–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ (—Ö–æ—Ç—è —É–¥–æ–±–Ω–µ–µ
#       –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã —é–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–ª –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–∏–∑—É, –ø–æ—Å–º–æ—Ç—Ä–∏–º) - –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
#   3. –ö–æ–º–∞–Ω–¥–∞ /ticket accept (–≤–º–µ—Å—Ç–æ /add) –ü–æ—Å–∫–æ–ª—å–∫—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ –≤–≤–æ–¥–∞, –∞—Ä–≥—É–º–µ–Ω—Ç —Å –Ω–∏–∫–Ω–µ–π–º–æ–º –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å.
#       –ï—Å–ª–∏ –ª—Å —é–∑–µ—Ä–∞ –∑–∞–∫—Ä—ã—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è close request –Ω–∞ 24 —á–∞—Å–∞ –≤ –∫–∞–Ω–∞–ª —Ç–∏–∫–µ—Ç–∞. –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å —Ä–æ–ª–∏ –º–µ–º–±–µ—Ä—É
#   4. –ö–æ–º–∞–Ω–¥–∞ /ticket deny –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
#   5. rcon??? - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∏–∫–Ω–µ–π–º–∞ –∏–∑ –¥–± –≤ –≤–∞–π—Ç–ª–∏—Å—Ç
#   6. –ò–¥–µ—è: —Å–¥–µ–ª–∞—Ç—å –∫–∞–Ω–∞–ª alerts –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —á—Ç–æ–±—ã —Ç—É–¥–∞ –±–æ—Ç –ø–∏—Å–∞–ª –∫–∞–∫–∏–µ-—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏–ª–∏ –µ—â–µ —á—Ç–æ-—Ç–æ
#   7. –í–æ–∑–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ç–∏–∫–µ—Ç –±–æ—Ç–æ–º (–Ω–æ —ç—Ç–æ –¥–ª—è –ª—É–∑–µ—Ä–æ–≤)
#   8. —à—Ç—É–∫–∞ —Å txt —Ñ–∞–π–ª–æ–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–æ-–ø–µ—Ä–≤—ã—Ö –æ–Ω –æ–±—â–∏–π –¥–ª—è –≤—Å–µ–π guilds, –≤–æ –≤—Ç–æ—Ä—ã—Ö –µ—Å–ª–∏ –Ω–µ—Å–∫. —á–µ–ª–æ–≤–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
#       –Ω–∞–∂–º—É—Ç –∫–Ω–æ–ø–∫—É, —Ç–æ –æ–Ω –Ω–µ —É—Å–ø–µ–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è 2 –∫–∞–Ω–∞–ª–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º) —á—Ç–æ –¥–µ–ª–∞—Ç—å —Ç–æ???
#   9. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø–µ–Ω —Å–æ—Ä—Å —Ç–∏–∫–µ—Ç –±–æ—Ç–æ–≤
#   10. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–º–∏—à–Ω—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ticket send-ticket-create-message –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ
#       –º–æ–¥–µ—Ä–∞–º–∏). –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–º–∏—à–Ω–æ–≤ (–º–æ–∂–Ω–æ –ª–∏ —Å–∫—Ä—ã—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≤—Å–µ—Ö –∫—Ä–æ–º–µ –∞–¥–º–∏–Ω–æ–≤?)
#   11. –ü–æ—á–µ–º—É –æ—à–∏–±–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å, –∞ –Ω–µ –≤ —Ñ–∞–π–ª???
#   12. –ö–æ–º–∞–Ω–¥–∞ poll —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –¥–ª—è –∫–æ–ª-–≤–∞ –æ–ø—Ü–∏–π (2 –ø–æ –¥–µ—Ñ–æ–ª—Ç—É)
#   13. —Å—É–±–∫–ª–∞—Å—Å–∏–Ω–≥ –±–æ—Ç–∞
#   14. –ø–æ–≤–æ–∑–∏—Ç—å—Å—è —Å –≥–∏—Ç—Ö–∞–±–æ–º (–±–µ–∫–∞–ø—ã + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ø–∫ –∏–ª–∏ —Ç–∏–ø–∞ —Ç–æ–≥–æ)
#   16. –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

import discord
from discord.commands import SlashCommandGroup, Option
from discord.ext import commands


class CreateTicket(commands.Cog):
    def __init__(self, bot):
        self.bot = bot

    class CreateTicketButton(discord.ui.View):
        def __init__(self):
            super().__init__(timeout=None)

        @discord.ui.button(label="Create ticket", style=discord.ButtonStyle.primary, emoji="üìù")
        async def button_callback(self, button, interaction):
            with open('cogs/tickets_counter.txt', 'r') as file:
                # read a list of lines into data
                tickets_counter = file.readline()
            tickets_counter = str(int(tickets_counter) + 1)
            category = discord.utils.get(interaction.guild.categories, name='krftn sus5y bot')
            ticket_channel = await interaction.guild.create_text_channel(f"ticket-{tickets_counter[0]}",
                                                                         category=category)
            with open('cogs/tickets_counter.txt', 'w') as file:
                file.writelines(str(tickets_counter))
            await ticket_channel.send("Write your request here")
            await interaction.response.send_message(f"New ticket created in {ticket_channel.mention}", ephemeral=True)

    ticket = SlashCommandGroup("ticket", "Ticket commands")

    @ticket.command(name='send-create-message', description="Sends a special message with 'Create ticket' button")
    # @option("channel", description="Channel to send the message to")
    async def send_create_ticket_message(self, ctx: discord.ApplicationContext,
                                         channel: Option(discord.TextChannel, "The channel to send the message to",
                                                         required=False)):
        if channel is None:
            await ctx.respond(f'Sending a create ticket message in {ctx.channel.mention}', ephemeral=True)
            await ctx.send("An embed is eventually gonna end up here", view=self.CreateTicketButton())
        else:
            create_ticket_button_obj = self.CreateTicketButton()
            create_ticket_button_obj.channel = channel
            await ctx.respond(f"Sending a create ticket message in {channel.mention}", ephemeral=True)
            await channel.send("An embed is eventually going to end up here", view=create_ticket_button_obj)

        # await ctx.send("An embed is eventually gonna end up here", view=self.CreateTicketButton())

    @commands.Cog.listener()
    async def on_member_join(self, member):
        guild = member.guild
        channel = discord.utils.get(guild.channels, name='create-ticket')
        await member.send(f"Welcome to {guild}!\nCreate a new ticket in {channel.mention}")


def setup(bot):
    bot.add_cog(CreateTicket(bot))
